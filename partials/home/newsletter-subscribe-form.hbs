{{#unless @member}}
  {{#if @site.members_enabled}}
    {{#unless @site.members_invite_only}}
      <div class="newsletter-subscription-form">
        <form data-members-form="subscribe" class="newsletter-form">
          {{!-- Name field (optional) --}}
          {{#if nameLabel}}
            <div class="form-group">
              <label for="{{nameLabel}}">Name</label>
              <input 
                type="text" 
                data-members-name 
                id="{{nameLabel}}" 
                placeholder="Your name"
                autocomplete="name"
              >
            </div>
          {{/if}}

          {{!-- Email field --}}
          <div class="form-group">
            <label for="{{emailLabel}}">Email Address</label>
            <input 
              type="email" 
              data-members-email 
              id="{{emailLabel}}" 
              placeholder="your@email.com"
              required
              autocomplete="email"
            >
          </div>

          {{!-- Newsletter Selection --}}
          <div class="form-group">
            <label>Choose Your Newsletters</label>
            <div class="newsletter-options">
              <div class="newsletter-option">
                <input 
                  type="checkbox" 
                  id="beating-newsletter" 
                  name="newsletters" 
                  value="beating"
                  data-newsletter="beating"
                >
                <label for="beating-newsletter" class="newsletter-label">
                  <div class="newsletter-info">
                    <h4>Beating</h4>
                    <p>A pop-up newsletter documenting the process of writing my long-suffering second novel. Updates on progress, challenges, and breakthroughs.</p>
                  </div>
                </label>
              </div>
              
              <div class="newsletter-option">
                <input 
                  type="checkbox" 
                  id="draft-mode-newsletter" 
                  name="newsletters" 
                  value="draft-mode"
                  data-newsletter="draft-mode"
                >
                <label for="draft-mode-newsletter" class="newsletter-label">
                  <div class="newsletter-info">
                    <h4>Draft Mode</h4>
                    <p>Monthly newsletter about writing, books, creativity and design. Join 1700+ readers for thoughtful insights and useful resources.</p>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <button type="submit" class="subscribe-btn">
            <span class="btn-text">Subscribe</span>
            <span class="btn-loading">Subscribing...</span>
          </button>

          <div data-members-success class="success-message">
            Thanks for subscribing! Please check your email to confirm.
          </div>

          <div data-members-error class="error-message">
            <!-- Error message will be populated by Ghost -->
          </div>
        </form>
      </div>

      <style>
        .newsletter-subscription-form {
          max-width: 500px;
          margin: 0 auto;
        }

        .newsletter-form {
          background: #ffffff;
          border: 1px solid #e5e5e5;
          border-radius: 6px;
          padding: 32px;
        }

        .form-group {
          margin-bottom: 24px;
        }

        .form-group label:first-child {
          display: block;
          font-size: 14px;
          font-weight: 600;
          color: #2e2e2e;
          margin-bottom: 8px;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .form-group input[type="email"],
        .form-group input[type="text"] {
          width: 100%;
          padding: 12px 16px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 16px;
          background: #ffffff;
          transition: border-color 0.2s ease;
        }

        .form-group input[type="email"]:focus,
        .form-group input[type="text"]:focus {
          outline: none;
          border-color: #666;
        }

        .newsletter-options {
          margin-top: 8px;
        }

        .newsletter-option {
          display: flex;
          align-items: flex-start;
          margin-bottom: 16px;
          padding: 16px;
          border: 1px solid #e5e5e5;
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s ease;
          background: #ffffff;
        }

        .newsletter-option:hover {
          border-color: #ccc;
          background: #fafafa;
        }

        .newsletter-option:last-child {
          margin-bottom: 0;
        }

        .newsletter-option input[type="checkbox"] {
          margin-right: 12px;
          margin-top: 2px;
          cursor: pointer;
        }

        .newsletter-label {
          cursor: pointer;
          flex: 1;
          font-weight: normal;
          text-transform: none;
          letter-spacing: normal;
          margin: 0;
        }

        .newsletter-info h4 {
          font-size: 16px;
          font-weight: 600;
          color: #2e2e2e;
          margin-bottom: 4px;
          line-height: 1.3;
        }

        .newsletter-info p {
          font-size: 14px;
          color: #666;
          line-height: 1.4;
          margin: 0;
        }

        .subscribe-btn {
          width: 100%;
          padding: 14px 24px;
          background-color: #2e2e2e;
          color: #ffffff;
          border: none;
          border-radius: 4px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: background-color 0.2s ease;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }

        .subscribe-btn:hover {
          background-color: #1a1a1a;
        }

        .btn-loading {
          display: none;
        }

        .subscribe-btn[data-members-loading] .btn-text {
          display: none;
        }

        .subscribe-btn[data-members-loading] .btn-loading {
          display: inline;
        }

        .success-message {
          display: none;
          margin-top: 16px;
          padding: 16px;
          background-color: #f0f9ff;
          color: #0c4a6e;
          border: 1px solid #bae6fd;
          border-radius: 4px;
          font-size: 14px;
        }

        .error-message {
          display: none;
          margin-top: 16px;
          padding: 16px;
          background-color: #fef2f2;
          color: #b91c1c;
          border: 1px solid #fecaca;
          border-radius: 4px;
          font-size: 14px;
        }

        [data-members-success] .success-message {
          display: block;
        }

        [data-members-error] .error-message {
          display: block;
        }
      </style>

      <script>
        // Custom script to handle newsletter selection
        document.addEventListener('DOMContentLoaded', function() {
          const form = document.querySelector('[data-members-form="subscribe"]');
          if (!form) return;

          // Newsletter ID mapping - Replace with your actual newsletter IDs
          const newsletterIds = {
            'beating': '67b8dc0a0db361000135048f',
            'draft-mode': '6270f8d75e2d3a0031603372'
          };

          // Handle form submission
          form.addEventListener('submit', function(e) {
            const selectedNewsletters = Array.from(document.querySelectorAll('input[name="newsletters"]:checked'));
            
            if (selectedNewsletters.length === 0) {
              e.preventDefault();
              alert('Please select at least one newsletter to subscribe to.');
              return;
            }

            // Add selected newsletter IDs to form data
            const newsletterIdInputs = document.querySelectorAll('input[name="newsletter-ids"]');
            newsletterIdInputs.forEach(input => input.remove());

            selectedNewsletters.forEach(checkbox => {
              const newsletterId = newsletterIds[checkbox.value];
              if (newsletterId) {
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = 'newsletter-ids';
                hiddenInput.value = newsletterId;
                form.appendChild(hiddenInput);
              }
            });
          });

          // Make newsletter options clickable
          document.querySelectorAll('.newsletter-option').forEach(option => {
            option.addEventListener('click', function(e) {
              if (e.target.type !== 'checkbox') {
                const checkbox = this.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;
                updateSelectedOptions();
              }
            });
          });

          // Visual feedback for selected options
          function updateSelectedOptions() {
            document.querySelectorAll('.newsletter-option').forEach(option => {
              const checkbox = option.querySelector('input[type="checkbox"]');
              if (checkbox.checked) {
                option.style.borderColor = '#666';
                option.style.backgroundColor = '#f8f8f8';
              } else {
                option.style.borderColor = '#e5e5e5';
                option.style.backgroundColor = '#ffffff';
              }
            });
          }

          // Listen for checkbox changes
          document.querySelectorAll('input[name="newsletters"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedOptions);
          });
        });
      </script>
    {{/unless}}
  {{/if}}
{{/unless}}